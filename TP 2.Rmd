---
title: "Trabajo Práctico 2,  EEA"
author: "Luis Nahuel Fernández y Andrés Sandoval"
date: '2022-10-30'
output: 
  rmdformats::robobook:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(here)
library(knitr)
library(ltm)
library(kableExtra)

setwd(here())
source("funciones/funciones.r")

usu_individual_T421 <- read.csv("EPH_usu_2do_Trim_2022_txt/usu_individual_T222.txt.txt", sep=";")
usu_individual_T421 %>% filter(ESTADO==1 & CAT_OCUP==3)->usu_individual_T421

auxiliares<-function(base){


  base$d5<-as.numeric(substr(base$PP04D_COD,nchar(base$PP04D_COD),nchar(base$PP04D_COD)))
  
  base$CALIFICACION<-as.numeric(substr(base$PP04D_COD,nchar(base$PP04D_COD),nchar(base$PP04D_COD)))
  base$JERARQUIA<-as.numeric(substr(base$PP04D_COD,nchar(base$PP04D_COD)-2,nchar(base$PP04D_COD)-2))
  # base$JERARQUIA<-ifelse(is.na(base$JERARQUIA), 0, base$JERARQUIA)

  base$CALIFICACION<-as.factor(base$CALIFICACION)
  base$JERARQUIA<-as.factor(base$JERARQUIA)
  
  base %>%  mutate(rol = case_when(
    ESTADO==1 & CAT_OCUP== 3 & (JERARQUIA==2 | JERARQUIA==0) ~  "Dirección",
    ESTADO==1 & CAT_OCUP== 3 & JERARQUIA==3 & CALIFICACION==1 ~  "Profesional",
    ESTADO==1 & CAT_OCUP== 3 & JERARQUIA==3 & CALIFICACION==2 ~  "tecnicos",
    ESTADO==1 & CAT_OCUP== 3 & JERARQUIA==3 & CALIFICACION==3 ~  "operativos",
    ESTADO==1 & CAT_OCUP== 3 & JERARQUIA==3 & CALIFICACION==4 ~  "Obrero NC",
    TRUE ~ "Otro"
    ))->base
  
  
  
    base %>%  mutate(INF = case_when(
    
    CAT_OCUP== 3 & PP07H==2 &  PP04C>5 & PP04B1==2  ~  "Informal",
    CAT_OCUP== 3 & PP07H==2 &  PP04C<6 & PP04B1==2 ~ "Informal",
    CAT_OCUP== 3 & PP07H==2 & PP04B1==1 ~ "Informal",
    CAT_OCUP== 3 & PP07H==1 & PP04B1==1 ~ "Formal",
    CAT_OCUP== 3 & PP07H==1 &  PP04C>5 & PP04B1==2   ~ "Formal",
    CAT_OCUP== 3 & PP07H==1 &  PP04C<6 & PP04B1==2   ~ "Formal"
    ))->base
  
  base$CH03<-as.factor(base$CH03)
  base$CAT_OCUP<-as.factor(base$CAT_OCUP)
  base$NIVEL_ED<-as.factor(base$NIVEL_ED)
  base$CH04<-as.factor(base$CH04)
  base$AGLOMERADO<-as.factor(base$AGLOMERADO)
  base$REGION<-as.factor(base$REGION)
  base$INF<-as.factor(base$INF)
  base$rol<-as.factor(base$rol)
  
  base$PP04C<-as.factor(base$PP04C)
  
  # base$CH06<-(base$CH06-min(base$CH06))/(max(base$CH06)- min(base$CH06))
  
  base$TECNO<-substr(base$PP04D_COD,4,4)
  base$car1<-substr(base$PP04D_COD,1,1)
  base$car2<-substr(base$PP04D_COD,1,2)
  
  base$TECNO<-as.factor(base$TECNO)
  
  base$car1<-as.factor(base$car1)
  base$car2<-as.factor(base$car2)
  
  base<-entra.cuchillo.salen.las.ramas(base)
  
  return(base)
  
}

usu_individual_T421<-auxiliares(usu_individual_T421)
usu_individual_T421$rama.eph<-as.factor(usu_individual_T421$rama.eph)
```

# Aclaración sobre el trabajo

Se trabajará solo con los ocupados ya que la naturaleza del ingreso es distinta según la categoría ocupacional y por lo tanto para poder obtener mejores resultados trabajaremos solo con la subpoblación de asalariados en el 2do trimestre de 2022.

# Características de la no respuesta

Hay tres tipos de no respuesta

MCAR: Missing completely at Random. La no respuesta es absolutamente aleatoria, no depende de ninguna variable. En este caso no es porblemática.  

MAR:  Missing at random. Hay variables que influencian la no respuesta en un marco de aleatoridad. En este caso se llevan adelante procedimientos para intentar disminuir los sesgos producidos por la misma.

MNAR: Missing Not at Random. La no respuesta no es aleatoria, dependiendo por entero de otras variables o incluso de sí misma. Es el caso más problemático de todos. Ejemplo de esto pueden ser las encuestas sobre consumo de drogas donde las mismas variables de estudio se condicionan a sí mismas generando sesgos en la no respuesta. 

# La no respuesta en la EPH


```{r s_rol}
usu_individual_T421 %>% group_by(rol) %>% summarise(n=n(),
                                                         no_respuesta=sum(P21==(-9)),
                                                         porcentaje=no_respuesta/n,
                                                         media=mean(P21))->roles
roles[order(roles$media),]->roles
roles %>% 
  knitr::kable(format = "html",
               align = "lccrr",
               caption = "No respuesta y media del ingreso según rol",
               digits = 2) %>% 
  kable_material(lightable_options = c("striped", "hover") , html_font = "Cambria" )
```



```{r s_sexo}
usu_individual_T421 %>% group_by(CH04) %>% summarise(n=n(),
                                                         no_respuesta=sum(P21==(-9)),
                                                         porcentaje=no_respuesta/n,
                                                         media=mean(P21))->sexo
sexo%>% 
  knitr::kable(format = "html",
               align = "lccrr",
               caption = "No respuesta y media del ingreso según sexo",
               digits = 2) %>% 
  kable_material(lightable_options = c("striped", "hover") , html_font = "Cambria" )
```




```{r s_intensi}
usu_individual_T421 %>% group_by(INTENSI) %>% summarise(n=n(),
                                                         no_respuesta=sum(P21==(-9)),
                                                         porcentaje=no_respuesta/n,
                                                         media=mean(P21))->intensidad

intensidad$INTENSI<-c("Subocupado",
                      "Ocupado",
                      "Sobreocupado",
                     "Ocupado que no trabajó en la
 semana "
)

intensidad[order(intensidad$media),]->intensidad

intensidad%>% 
  knitr::kable(format = "html",
               align = "lccrr",
               caption = "No respuesta y media del ingreso según intensidad laboral",
               digits = 2) %>% 
  kable_material(lightable_options = c("striped", "hover") , html_font = "Cambria" )
```




```{r s_reg}
usu_individual_T421 %>% group_by(NIVEL_ED) %>% summarise(n=n(),
                                                         no_respuesta=sum(P21==(-9)),
                                                         porcentaje=no_respuesta/n,
                                                         media=mean(P21))->nivel_educativo

nivel_educativo$NIVEL_ED<-c("Primario incompleto",
                            "Primario completo",
                            "Secundario incompleto",
                            "Secundario completo",
                            "Universitario incompleto",
                            "Universitario completo",
                            "NS/NR")

nivel_educativo[order(nivel_educativo$media),]->nivel_educativo


nivel_educativo%>% 
  knitr::kable(format = "html",
               align = "lccrr",
               caption = "No respuesta y media del ingreso según nivel educativo",
               digits = 2) %>% 
  kable_material(lightable_options = c("striped", "hover") , html_font = "Cambria" )
```



